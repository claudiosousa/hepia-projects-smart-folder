\hypertarget{finder_8c}{}\section{finder.\+c File Reference}
\label{finder_8c}\index{finder.\+c@{finder.\+c}}


The finder retrives the list of files matching an expression.  


{\ttfamily \#include $<$dirent.\+h$>$}\\*
{\ttfamily \#include $<$string.\+h$>$}\\*
{\ttfamily \#include $<$sys/stat.\+h$>$}\\*
{\ttfamily \#include $<$unistd.\+h$>$}\\*
{\ttfamily \#include \char`\"{}finder.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}io.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}logger.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}vendor/uthash.\+h\char`\"{}}\\*
Include dependency graph for finder.\+c\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{finder_8c__incl}
\end{center}
\end{figure}
\subsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structfile__t}{file\+\_\+t}
\begin{DoxyCompactList}\small\item\em Hashtable entry type used in {\ttfamily files}. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef struct \hyperlink{structfile__t}{file\+\_\+t} \hyperlink{finder_8c_a67703743f2db513ba0def3664b12c985}{file\+\_\+t}
\begin{DoxyCompactList}\small\item\em Hashtable entry type used in {\ttfamily files}. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static \hyperlink{structfinder__t}{finder\+\_\+t} $\ast$ \hyperlink{finder_8c_ac340644baae8a9317350f9e392c42368}{finder\+\_\+add\+\_\+found\+\_\+file} (char $\ast$filename, \hyperlink{structfinder__t}{finder\+\_\+t} $\ast$currentfile)
\begin{DoxyCompactList}\small\item\em Adds the found valid file to the list of found files. \end{DoxyCompactList}\item 
static bool \hyperlink{finder_8c_a025d083ddfaf8d1f24984a6f2dac247e}{finder\+\_\+hash\+\_\+exist} (long unsigned int inode)\hypertarget{finder_8c_a025d083ddfaf8d1f24984a6f2dac247e}{}\label{finder_8c_a025d083ddfaf8d1f24984a6f2dac247e}

\begin{DoxyCompactList}\small\item\em Verifies if an inode id has already been processed. \end{DoxyCompactList}\item 
static void \hyperlink{finder_8c_ab2145ca21a64cfad661093363718886d}{finder\+\_\+hash\+\_\+add} (long unsigned int inode)\hypertarget{finder_8c_ab2145ca21a64cfad661093363718886d}{}\label{finder_8c_ab2145ca21a64cfad661093363718886d}

\begin{DoxyCompactList}\small\item\em Adds an inode id to the hashtable of processed files. \end{DoxyCompactList}\item 
static void \hyperlink{finder_8c_aa6168ebbf59fa8aa0a5cb2ad29126119}{finder\+\_\+hash\+\_\+clear} ()\hypertarget{finder_8c_aa6168ebbf59fa8aa0a5cb2ad29126119}{}\label{finder_8c_aa6168ebbf59fa8aa0a5cb2ad29126119}

\begin{DoxyCompactList}\small\item\em Clears (frees) the processed files hashtable. \end{DoxyCompactList}\item 
static \hyperlink{structfinder__t}{finder\+\_\+t} $\ast$ \hyperlink{finder_8c_ac6a4585aa622dde1e020ec1315dc508c}{finder\+\_\+find\+\_\+in\+\_\+dir} (char $\ast$dir, \hyperlink{structfinder__t}{finder\+\_\+t} $\ast$filelist, \hyperlink{structparser__t}{parser\+\_\+t} $\ast$expression)
\begin{DoxyCompactList}\small\item\em Searches a directory recursively for files matching the expression. \end{DoxyCompactList}\item 
static \hyperlink{structfinder__t}{finder\+\_\+t} $\ast$ \hyperlink{finder_8c_a412e38578fba998523148c001076dd17}{finder\+\_\+process\+\_\+dent} (struct dirent $\ast$dent, char $\ast$dirpath, \hyperlink{structfinder__t}{finder\+\_\+t} $\ast$filelist, \hyperlink{structparser__t}{parser\+\_\+t} $\ast$expression)
\begin{DoxyCompactList}\small\item\em Processes a found directory entity. \end{DoxyCompactList}\item 
\hyperlink{structfinder__t}{finder\+\_\+t} $\ast$ \hyperlink{finder_8c_aed5e5c02d7edae974a768b4229453a97}{finder\+\_\+find} (char $\ast$search\+\_\+path, \hyperlink{structparser__t}{parser\+\_\+t} $\ast$expression)
\begin{DoxyCompactList}\small\item\em Finds the files in the {\ttfamily search\+\_\+path} matchin the {\ttfamily expression} \end{DoxyCompactList}\item 
void \hyperlink{finder_8c_a4a192d238e16272f38645ae201f1748f}{finder\+\_\+free} (\hyperlink{structfinder__t}{finder\+\_\+t} $\ast$finder)
\begin{DoxyCompactList}\small\item\em Frees the memory allocated by {\ttfamily finder} \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
static struct \hyperlink{structfile__t}{file\+\_\+t} $\ast$ \hyperlink{finder_8c_a8bb2e2bcd7c9c20c6bdf286c0c1b67e4}{files} = N\+U\+LL
\begin{DoxyCompactList}\small\item\em Hashtable containing the processed files. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
The finder retrives the list of files matching an expression. 

A specified is search resursively for all find valid against a give filtering expression.

Symbolic links are followed, and an hashtable is kept with the id\textquotesingle{}s (inode id) of the processed paths to avoid processing the same paths twice and avoid infinte loops. 

\subsection{Typedef Documentation}
\index{finder.\+c@{finder.\+c}!file\+\_\+t@{file\+\_\+t}}
\index{file\+\_\+t@{file\+\_\+t}!finder.\+c@{finder.\+c}}
\subsubsection[{\texorpdfstring{file\+\_\+t}{file_t}}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf file\+\_\+t}  {\bf file\+\_\+t}}\hypertarget{finder_8c_a67703743f2db513ba0def3664b12c985}{}\label{finder_8c_a67703743f2db513ba0def3664b12c985}


Hashtable entry type used in {\ttfamily files}. 

Each instance contains the inode id of a path already processed \begin{DoxySeeAlso}{See also}
\hyperlink{finder_8c_a8bb2e2bcd7c9c20c6bdf286c0c1b67e4}{files} 
\end{DoxySeeAlso}


\subsection{Function Documentation}
\index{finder.\+c@{finder.\+c}!finder\+\_\+add\+\_\+found\+\_\+file@{finder\+\_\+add\+\_\+found\+\_\+file}}
\index{finder\+\_\+add\+\_\+found\+\_\+file@{finder\+\_\+add\+\_\+found\+\_\+file}!finder.\+c@{finder.\+c}}
\subsubsection[{\texorpdfstring{finder\+\_\+add\+\_\+found\+\_\+file(char $\ast$filename, finder\+\_\+t $\ast$currentfile)}{finder_add_found_file(char *filename, finder_t *currentfile)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf finder\+\_\+t}$\ast$ finder\+\_\+add\+\_\+found\+\_\+file (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{filename, }
\item[{{\bf finder\+\_\+t} $\ast$}]{currentfile}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{finder_8c_ac340644baae8a9317350f9e392c42368}{}\label{finder_8c_ac340644baae8a9317350f9e392c42368}


Adds the found valid file to the list of found files. 


\begin{DoxyParams}{Parameters}
{\em filename} & Found file\textquotesingle{}s name \\
\hline
{\em currentfile} & Chained list of found files \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
New pointer to the found files chained list 
\end{DoxyReturn}


Definition at line 41 of file finder.\+c.

\index{finder.\+c@{finder.\+c}!finder\+\_\+find@{finder\+\_\+find}}
\index{finder\+\_\+find@{finder\+\_\+find}!finder.\+c@{finder.\+c}}
\subsubsection[{\texorpdfstring{finder\+\_\+find(char $\ast$search\+\_\+path, parser\+\_\+t $\ast$expression)}{finder_find(char *search_path, parser_t *expression)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf finder\+\_\+t}$\ast$ finder\+\_\+find (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{search\+\_\+path, }
\item[{{\bf parser\+\_\+t} $\ast$}]{expression}
\end{DoxyParamCaption}
)}\hypertarget{finder_8c_aed5e5c02d7edae974a768b4229453a97}{}\label{finder_8c_aed5e5c02d7edae974a768b4229453a97}


Finds the files in the {\ttfamily search\+\_\+path} matchin the {\ttfamily expression} 

Search is performed recusively and symbolic links are followed.


\begin{DoxyParams}{Parameters}
{\em search\+\_\+path} & Where to look for the files \\
\hline
{\em expression} & Filter expression used against found files \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
List of found files 
\end{DoxyReturn}


Definition at line 172 of file finder.\+c.

\index{finder.\+c@{finder.\+c}!finder\+\_\+find\+\_\+in\+\_\+dir@{finder\+\_\+find\+\_\+in\+\_\+dir}}
\index{finder\+\_\+find\+\_\+in\+\_\+dir@{finder\+\_\+find\+\_\+in\+\_\+dir}!finder.\+c@{finder.\+c}}
\subsubsection[{\texorpdfstring{finder\+\_\+find\+\_\+in\+\_\+dir(char $\ast$dir, finder\+\_\+t $\ast$filelist, parser\+\_\+t $\ast$expression)}{finder_find_in_dir(char *dir, finder_t *filelist, parser_t *expression)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf finder\+\_\+t} $\ast$ finder\+\_\+find\+\_\+in\+\_\+dir (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{dir, }
\item[{{\bf finder\+\_\+t} $\ast$}]{filelist, }
\item[{{\bf parser\+\_\+t} $\ast$}]{expression}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{finder_8c_ac6a4585aa622dde1e020ec1315dc508c}{}\label{finder_8c_ac6a4585aa622dde1e020ec1315dc508c}


Searches a directory recursively for files matching the expression. 

Iterates over the directory entities and delegates their processing to {\ttfamily finder\+\_\+process\+\_\+dent}. Directories are added to the hastable of processed paths. 
\begin{DoxyParams}{Parameters}
{\em dir} & Directory full path \\
\hline
{\em filelist} & Pointer to the found files chained list \\
\hline
{\em expression} & Filtering expression \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
New pointer to the found files chained list 
\end{DoxyReturn}


Definition at line 139 of file finder.\+c.

\index{finder.\+c@{finder.\+c}!finder\+\_\+free@{finder\+\_\+free}}
\index{finder\+\_\+free@{finder\+\_\+free}!finder.\+c@{finder.\+c}}
\subsubsection[{\texorpdfstring{finder\+\_\+free(finder\+\_\+t $\ast$finder)}{finder_free(finder_t *finder)}}]{\setlength{\rightskip}{0pt plus 5cm}void finder\+\_\+free (
\begin{DoxyParamCaption}
\item[{{\bf finder\+\_\+t} $\ast$}]{finder}
\end{DoxyParamCaption}
)}\hypertarget{finder_8c_a4a192d238e16272f38645ae201f1748f}{}\label{finder_8c_a4a192d238e16272f38645ae201f1748f}


Frees the memory allocated by {\ttfamily finder} 


\begin{DoxyParams}{Parameters}
{\em finder} & The instance to be freed \\
\hline
\end{DoxyParams}


Definition at line 179 of file finder.\+c.

\index{finder.\+c@{finder.\+c}!finder\+\_\+process\+\_\+dent@{finder\+\_\+process\+\_\+dent}}
\index{finder\+\_\+process\+\_\+dent@{finder\+\_\+process\+\_\+dent}!finder.\+c@{finder.\+c}}
\subsubsection[{\texorpdfstring{finder\+\_\+process\+\_\+dent(struct dirent $\ast$dent, char $\ast$dirpath, finder\+\_\+t $\ast$filelist, parser\+\_\+t $\ast$expression)}{finder_process_dent(struct dirent *dent, char *dirpath, finder_t *filelist, parser_t *expression)}}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf finder\+\_\+t}$\ast$ finder\+\_\+process\+\_\+dent (
\begin{DoxyParamCaption}
\item[{struct dirent $\ast$}]{dent, }
\item[{char $\ast$}]{dirpath, }
\item[{{\bf finder\+\_\+t} $\ast$}]{filelist, }
\item[{{\bf parser\+\_\+t} $\ast$}]{expression}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{finder_8c_a412e38578fba998523148c001076dd17}{}\label{finder_8c_a412e38578fba998523148c001076dd17}


Processes a found directory entity. 

If it is a {\itshape directory}\+:
\begin{DoxyItemize}
\item we use {\ttfamily finder\+\_\+find\+\_\+in\+\_\+dir} to analyze the content
\end{DoxyItemize}

If it is a {\itshape regular file}\+:
\begin{DoxyItemize}
\item we check that if has not been processed yet
\item we check if is valid file against the expression
\item if the two previous conditions are met\+:
\begin{DoxyItemize}
\item it is added to the hashtable of processed files
\item it is added to the list of valid files found
\end{DoxyItemize}
\end{DoxyItemize}

If it is a {\itshape symbolic link}, we retrieve the target and check the target type\+:
\begin{DoxyItemize}
\item if it is a $\ast$directory, we proceed with the above conditions for directories
\item otherwise we proceed with above conditions for regular files
\end{DoxyItemize}


\begin{DoxyParams}{Parameters}
{\em dent} & Directory entity to process \\
\hline
{\em dirpath} & Directory entity full path \\
\hline
{\em filelist} & Pointer to the found files chained list \\
\hline
{\em expression} & Filtering expression \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
New pointer to the found files chained list 
\end{DoxyReturn}


Definition at line 100 of file finder.\+c.



\subsection{Variable Documentation}
\index{finder.\+c@{finder.\+c}!files@{files}}
\index{files@{files}!finder.\+c@{finder.\+c}}
\subsubsection[{\texorpdfstring{files}{files}}]{\setlength{\rightskip}{0pt plus 5cm}struct {\bf file\+\_\+t}$\ast$ files = N\+U\+LL\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{finder_8c_a8bb2e2bcd7c9c20c6bdf286c0c1b67e4}{}\label{finder_8c_a8bb2e2bcd7c9c20c6bdf286c0c1b67e4}


Hashtable containing the processed files. 

Used to avoid processing same paths twice. \begin{DoxySeeAlso}{See also}
\hyperlink{structfile__t}{file\+\_\+t} 
\end{DoxySeeAlso}


Definition at line 25 of file finder.\+c.

